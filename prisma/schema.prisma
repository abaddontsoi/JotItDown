generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "mongodb"
    url      = env("DATABASE_URL")
}

enum TaskInfoStatus {
    Draft
    Pending
    Running
    Done
    OverDue
}

enum UserStatus {
    Enabled
    Disabled
}

// should discover more on user authentication
model User {
    id String @id @default(auto()) @map("_id") @db.ObjectId

    // allows duplicated user display name
    userName String
    userLoginName String @unique
    userPwdHash String
    userHashtagNumber Int

    // deleting account will actually remove their related record in database, not setting a field to false
    status UserStatus

    createdAt DateTime @default(now()) // also used as the start date if the task
    updatedAt DateTime @updatedAt

    @@unique([userName, userHashtagNumber])
}

model TaskInfo {
    id String @id @default(auto()) @map("_id") @db.ObjectId

    title       String?
    description String

    status TaskInfoStatus @default(Draft)

    deadline DateTime

    parentContentBlockid String       @db.ObjectId
    parentContentBlock   ContentBlock @relation(fields: [parentContentBlockid], references: [id], onDelete: Cascade, onUpdate: NoAction)

    createdAt DateTime @default(now()) // also used as the start date if the task
    updatedAt DateTime @updatedAt
}

model ContentBlock {
    id String @id @default(auto()) @map("_id") @db.ObjectId

    title String?

    content String

    parentNoteId String @db.ObjectId
    parentNote   Note   @relation(fields: [parentNoteId], references: [id], onDelete: Cascade, onUpdate: NoAction)

    TaskInfo TaskInfo[]

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

model Note {
    id String @id @default(auto()) @map("_id") @db.ObjectId

    title String

    categoryId String?   @db.ObjectId
    category   Category? @relation(fields: [categoryId], references: [id])

    parentNoteId String? @db.ObjectId
    parentNote   Note?   @relation(name: "ParentChildrenNoteRelation", fields: [parentNoteId], references: [id], onDelete: NoAction, onUpdate: NoAction)

    stared Boolean

    readCount   Int @default(0)
    updateCount Int @default(0)

    isQuickNote Boolean

    hidden Boolean

    contentBlocks ContentBlock[]

    childrenNotes Note[] @relation(name: "ParentChildrenNoteRelation")

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

model Category {
    id String @id @default(auto()) @map("_id") @db.ObjectId

    name String

    parentCategoryId String?   @db.ObjectId
    parentCategory   Category? @relation(name: "CategoryParentChildrenRelation", fields: [parentCategoryId], references: [id], onDelete: NoAction, onUpdate: NoAction)

    category Category[] @relation(name: "CategoryParentChildrenRelation")

    Note Note[]

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}
